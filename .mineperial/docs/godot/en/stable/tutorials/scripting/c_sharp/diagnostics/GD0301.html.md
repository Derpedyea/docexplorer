**GD0301 – “The generic type argument must be a Variant compatible type”**

> This diagnostic is raised when a generic type argument that is not Variant‑compatible is used in a C# script that interacts with Godot’s type system. The error is *breaking* and is enabled by default.

---

## 1. Rule Information

| Attribute | Value |
|-----------|-------|
| **Rule ID** | `GD0301` |
| **Category** | Usage |
| **Severity** | Breaking |
| **Enabled by default** | Yes |

---

## 2. Cause

The error is triggered when you pass a type that the Godot engine does not support as a Variant to a generic API.  
Typical examples include:

- Using `int` with `Signal<T>` where `T` must be a Variant type.
- Using custom classes or structs that haven’t been marked with `[MustBeVariant]`.

> **Why it matters**  
> Godot’s Variant system is used for interop between the engine and script. When a generic parameter is not Variant‑compatible, the engine cannot correctly marshal the value, leading to runtime failures or undefined behaviour.

---

## 3. Fix

### A. Use a Variant‑compatible type

Replace the offending type with one that the engine knows how to handle (e.g., `int`, `float`, `Vector2`, `Node`, `Dictionary`, etc.).

```csharp
// Bad
Signal<CustomStruct> mySignal;

// Good
Signal<int> mySignal;           // or
Signal<MyNode> mySignal;        // if MyNode extends Godot.Object
```

### B. Apply the `[MustBeVariant]` attribute

If you must use a custom type, annotate it with `[MustBeVariant]` and register it with the engine so that it can be marshalled as a Variant.

```csharp
using Godot;
using Godot.Collections;   // for Variant

[MustBeVariant]
public class MyData
{
    public int Id;
    public string Name;
}
```

> **Note** – After adding the attribute, ensure the type is registered with the engine (e.g., via `AddType<MyData>()` in the project’s initialization).

---

## 4. Example

```csharp
// Incorrect: CustomStruct is not Variant‑compatible
public struct CustomStruct
{
    public int Value;
}

public class MyClass : Node
{
    // This line triggers GD0301
    [Signal] public delegate void MySignal(CustomStruct data);
}
```

```csharp
// Corrected: Use a Variant‑compatible type or mark the struct
[MustBeVariant]
public struct CustomStruct
{
    public int Value;
}

public class MyClass : Node
{
    [Signal] public delegate void MySignal(CustomStruct data);
}
```

---

## 5. Related Rules

- **[GD0302]** – “The generic type parameter must be annotated with the ‘[MustBeVariant]’ attribute”
- **[GD0203]** – “The delegate signature of the signal must return void”

---

## 6. Further Reading

- [C# Type System – Variants](https://docs.godotengine.org/en/stable/tutorials/scripting/c_sharp/types/variant.html)
- [Signals in C#](https://docs.godotengine.org/en/stable/tutorials/scripting/c_sharp/signals.html)

---

**Next rule**: [GD0302](GD0302.html)  
**Previous rule**: [GD0203](GD0203.html)